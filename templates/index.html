<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Website Monitor & Scraper</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>ğŸŒ Website Monitor & Scraper</h1>
            <p>Monitor changes, scrape content, chat with AI, and capture screenshots.</p>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('monitor')">Monitor</button>
            <button class="nav-tab" onclick="showTab('analytics')">Analytics</button>
            <button class="nav-tab" onclick="showTab('linkedin')">ğŸ‘” LinkedIn</button>
            <button class="nav-tab" onclick="showTab('outreach')">ğŸ“§ Outreach</button>
            <button class="nav-tab" onclick="showTab('chat')">ğŸ’¬ Chat (RAG)</button>
            <button class="nav-tab" onclick="showTab('diff')">ğŸ” Visual Diff</button>
        </div>

        <!-- Monitor View -->
        <div id="monitor-view">
            <div class="input-group">
                <input type="text" id="urlInput" placeholder="Enter website URL to monitor (e.g.,https://example.com)">
                <input type="password" id="apiKeyInput" placeholder="OpenAI API Key (Optional)">
                <div style="display: flex; gap: 10px; align-items: center;">
                    <input type="number" id="intervalVal" value="60" min="1" style="width: 100px;">
                    <select id="intervalUnit" style="flex: 1;">
                        <option value="seconds">Seconds</option>
                        <option value="minutes" selected>Minutes</option>
                        <option value="hours">Hours</option>
                        <option value="days">Days</option>
                    </select>
                </div>
                <div
                    style="display: flex; align-items: center; gap: 10px; padding: 12px; background: #f0f7ff; border-radius: 8px; border: 1px solid #b3d9ff;">
                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; margin: 0;">
                        <input type="checkbox" id="captureScreenshots"
                            style="width: 18px; height: 18px; cursor: pointer;">
                        <strong>ğŸ“¸ Capture Screenshots</strong>
                    </label>
                    <span style="font-size: 13px; color: #666;">(Screenshots will be saved for all scraped pages)</span>
                </div>
                <button onclick="addUrl()">Start Monitoring</button>
            </div>
            <div class="grid" id="pagesGrid"></div>
        </div>

        <!-- Analytics View -->
        <div id="analytics-view" style="display: none;">
            <div class="analytics-controls">
                <select id="timeWindow" onchange="loadAnalytics(this.value)">
                    <option value="24h">Last 24 Hours</option>
                    <option value="7d">Last 7 Days</option>
                    <option value="14d">Last 14 Days</option>
                </select>
                <button onclick="loadAnalytics(document.getElementById('timeWindow').value)">Refresh</button>
            </div>
            <div class="kpi-grid" id="kpiGrid"></div>
            <div class="charts-container">
                <div class="chart-card">
                    <h3>Scrapes vs Changes</h3>
                    <canvas id="trendsChart"></canvas>
                </div>
                <div class="chart-card">
                    <h3>Top Sites by Changes</h3>
                    <canvas id="topSitesChart"></canvas>
                </div>
            </div>
            <div class="analytics-details">
                <div class="details-card">
                    <h3>Recent Changes</h3>
                    <div id="recentChangesFeed" class="feed-list"></div>
                </div>
                <div class="details-card">
                    <h3>Site Insights</h3>
                    <div id="siteInsightsList" class="insights-list"></div>
                </div>
            </div>
        </div>

        <!-- LinkedIn View -->
        <div id="linkedin-view" style="display: none;">
            <div style="margin-bottom: 30px;">
                <h2 style="margin: 0 0 10px 0;">ğŸ‘” LinkedIn Scraper</h2>
                <p style="color: #666;">Scrape profiles and company pages. Requires one-time login.</p>
            </div>

            <div class="input-group" style="margin-bottom: 20px;">
                <button onclick="linkedinLogin()" style="background: #0077b5; color: white;">ğŸ”‘ Login & Save
                    Session</button>
                <span style="margin-left: 10px; color: #666; font-size: 13px;">(Click this once to log in
                    manually)</span>
            </div>

            <div class="input-group">
                <input type="text" id="linkedinUrlInput" placeholder="Enter LinkedIn Profile or Company URL">
                <button onclick="scrapeLinkedin()" style="background: #0077b5; color: white;">Scrape Data</button>
            </div>

            <div id="linkedinResult"
                style="margin-top: 20px; padding: 20px; background: #f9f9f9; border-radius: 8px; min-height: 100px; white-space: pre-wrap;">
                <p style="color: #999; text-align: center;">Scraped data will appear here...</p>
            </div>
        </div>

        <!-- Outreach View -->
        <div id="outreach-view" style="display: none;">
            <div style="margin-bottom: 30px;">
                <h2 style="margin: 0 0 10px 0;">ğŸ“§ Email Outreach Campaign</h2>
                <p style="color: #666;">Search for nursing home companies and send personalized emails.</p>
            </div>

            <!-- Search Section -->
            <div class="input-group"
                style="margin-bottom: 30px; border: 2px solid #e3f2fd; padding: 20px; border-radius: 8px; background: #f8fbff;">
                <h3 style="margin: 0 0 15px 0;">ğŸ” Find Leads</h3>
                <input type="text" id="outreachKeywords" placeholder="Keywords (e.g., Home Health Care)"
                    value="Home Health Care">
                <input type="text" id="outreachLocation" placeholder="Location (e.g., Los Angeles County)"
                    value="Southern California">
                <input type="password" id="outreachApiKey"
                    placeholder="OpenAI API Key (Optional - for contact name extraction)">
                <input type="number" id="outreachMaxResults" placeholder="Max Results" value="50" min="1" max="100"
                    style="width: 150px;">
                <button onclick="searchLeads()" style="background: #4CAF50; color: white;">Search & Extract
                    Contacts</button>
                <button onclick="clearLeads()" style="background: #f44336; color: white;">Clear All Leads</button>
            </div>

            <!-- Leads Table -->
            <div style="margin-bottom: 30px;">
                <h3 style="margin: 0 0 15px 0;">ğŸ“‹ Found Leads <span id="leadCount"
                        style="color: #666; font-size: 14px;"></span></h3>
                <button onclick="refreshLeads()" style="margin-bottom: 10px;">ğŸ”„ Refresh</button>
                <div style="overflow-x: auto;">
                    <table id="leadsTable"
                        style="width: 100%; border-collapse: collapse; background: white; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                        <thead>
                            <tr style="background: #f5f5f5; border-bottom: 2px solid #ddd;">
                                <th style="padding: 12px; text-align: left;">Company</th>
                                <th style="padding: 12px; text-align: left;">Email</th>
                                <th style="padding: 12px; text-align: left;">Contact</th>
                                <th style="padding: 12px; text-align: left;">Location</th>
                                <th style="padding: 12px; text-align: left;">Status</th>
                                <th style="padding: 12px; text-align: left;">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="leadsTableBody">
                            <tr>
                                <td colspan="6" style="padding: 40px; text-align: center; color: #999;">
                                    No leads yet. Click "Search & Extract Contacts" to find companies.
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Email Campaign Section -->
            <div class="input-group"
                style="border: 2px solid #fff3cd; padding: 20px; border-radius: 8px; background: #fffbf0;">
                <h3 style="margin: 0 0 15px 0;">âœ‰ï¸ Email Campaign</h3>

                <h4 style="margin: 15px 0 8px 0;">SMTP Configuration</h4>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                    <input type="text" id="smtpHost" placeholder="SMTP Host (e.g., smtp.gmail.com)"
                        value="smtp.gmail.com">
                    <input type="number" id="smtpPort" placeholder="Port (e.g., 587)" value="587">
                    <input type="text" id="smtpUsername" placeholder="SMTP Username">
                    <input type="password" id="smtpPassword" placeholder="SMTP Password (App Password)">
                    <input type="text" id="smtpFromEmail" placeholder="From Email Address">
                </div>

                <h4 style="margin: 15px 0 8px 0;">Email Template</h4>
                <input type="text" id="emailSubject" placeholder="Email Subject"
                    value="Healthcare Partnership Opportunity">
                <textarea id="emailBody" rows="8"
                    placeholder="Email body (HTML supported). Use {company_name} and {contact_name} for personalization."
                    style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-family: 'Courier New', monospace;"><p>Dear {contact_name},</p>

<p>I hope this message finds you well. I wanted to reach out to {company_name} regarding a potential partnership opportunity.</p>

<p>Please visit our website for more information: <a href="https://example.com">Learn More</a></p>

<p>Best regards,<br>Your Name</p></textarea>

                <button onclick="sendCampaign()"
                    style="background: #FF9800; color: white; font-size: 16px; padding: 15px;">
                    ğŸ“¤ Send Emails to All Pending Leads
                </button>
                <p style="color: #666; font-size: 13px; margin-top: 10px;">
                    âš ï¸ Emails will be sent one by one to all leads with "new" status. Make sure SMTP settings are
                    correct.
                </p>
            </div>
        </div>

        <!-- Chat View -->
        <div id="chat-view" style="display: none;">
            <div class="input-group">
                <input type="text" id="chatUrlInput" placeholder="Enter website URL to chat with">
                <input type="password" id="chatApiKeyInput" placeholder="OpenAI API Key">
            </div>
            <div class="chat-container"
                style="margin-top: 20px; border: 1px solid #eee; padding: 20px; border-radius: 8px; height: 400px; overflow-y: auto; background: #f9f9f9;"
                id="chatMessages">
                <div class="chat-message system">
                    <p>Enter a URL and ask a question to chat with the website content.</p>
                </div>
            </div>
            <div class="input-group" style="margin-top: 20px;">
                <input type="text" id="chatQueryInput" placeholder="Ask a question..."
                    onkeypress="if(event.key === 'Enter') sendChat()">
                <button onclick="sendChat()">Send</button>
            </div>
        </div>

        <!-- Visual Diff View -->
        <div id="diff-view" style="display: none;">
            <div style="margin-bottom: 30px;">
                <h2 style="margin: 0 0 10px 0;">ğŸ” Website Change Comparison</h2>
                <p style="color: #666;">Compare monitored website versions side-by-side with text changes</p>
            </div>

            <div
                style="display: flex; gap: 15px; margin-bottom: 25px; padding: 15px; background: #f0f0f0; border-radius: 10px;">
                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                    <input type="radio" name="diffMode" value="url" checked onchange="toggleDiffMode()">
                    <strong>ğŸ“Š Compare Monitored URL</strong> (Shows version history)
                </label>
                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                    <input type="radio" name="diffMode" value="text" onchange="toggleDiffMode()">
                    <strong>ğŸ“ Manual Text Comparison</strong>
                </label>
            </div>

            <div id="urlCompareMode">
                <div class="input-group" style="margin-bottom: 25px;">
                    <input type="text" id="compareUrlInput" placeholder="Enter monitored URL to compare versions">
                    <button onclick="compareWebsiteVersions()"
                        style="background: #4CAF50; color: white; padding: 12px 24px; font-weight: 600;">ğŸ” Compare
                        Versions</button>
                </div>
                <div id="versionComparisonResult">
                    <div
                        style="text-align: center; padding: 60px 20px; background: #f9f9f9; border-radius: 12px; color: #999;">
                        <h3 style="margin: 0 0 10px 0; color: #666;">Enter a monitored URL above</h3>
                        <p>I'll show you side-by-side comparison of the last two versions with text changes</p>
                    </div>
                </div>
            </div>

            <div id="textCompareMode" style="display: none;">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div>
                        <label style="font-weight: 600; display: block; margin-bottom: 8px;">Original Text (Version
                            1)</label>
                        <textarea id="diffText1" rows="10"
                            style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-family: 'Courier New', monospace; font-size: 13px;"
                            placeholder="Paste original text here..."></textarea>
                    </div>
                    <div>
                        <label style="font-weight: 600; display: block; margin-bottom: 8px;">New Text (Version
                            2)</label>
                        <textarea id="diffText2" rows="10"
                            style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-family: 'Courier New', monospace; font-size: 13px;"
                            placeholder="Paste new text here..."></textarea>
                    </div>
                </div>
                <div style="text-align: center; margin-bottom: 20px;">
                    <button onclick="generateDiff()"
                        style="padding: 12px 32px; background: #4CAF50; color: white; border: none; border-radius: 8px; font-size: 16px; cursor: pointer; font-weight: 600;">Generate
                        Diff</button>
                </div>
                <div id="diffResult"
                    style="margin-top: 20px; padding: 20px; background: #f9f9f9; border-radius: 8px; min-height: 100px;">
                    <p style="color: #999; text-align: center;">Enter text in both boxes above and click "Generate Diff"
                        to see the comparison.</p>
                </div>
            </div>

            <div
                style="margin-top: 20px; padding: 15px; background: #fff3cd; border-radius: 8px; border-left: 4px solid #ffc107;">
                <strong>ğŸ¨ Legend:</strong>
                <span style="background: #ffebee; padding: 2px 6px; margin-left: 10px; border-radius: 3px;">Red =
                    Removed</span>
                <span style="background: #e8f5e9; padding: 2px 6px; margin-left: 10px; border-radius: 3px;">Green =
                    Added</span>
                <span style="background: #f5f5f5; padding: 2px 6px; margin-left: 10px; border-radius: 3px;">Gray =
                    Unchanged</span>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>

</html>